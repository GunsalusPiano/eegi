{% extends 'base.html' %}
{% load extra_tags %}
{% load staticfiles %}
{% block body_id %}wormbase_gene_descs{% endblock %}
{% block page_title %}Wormbase Gene Descriptions{% endblock %}
WormBase version: WS250

{% block content %}
<input type="file" id="geneFile" multiple size="50">
<button id='searchFile' type='button'>Search</button>

<!-- <input id='test' type='text'> -->

<p id="demo">My contents are:</p>

<table id='gene_table'
  class='display compact cell-border'>
  <thead>
    <tr>
      <th>id</th>
      <th>cosmid_id</th>
      <th>locus</th>
      <th>gene_type</th>
      <th>gene_class</th>
      <th>functional_description</th>
    </tr>
  </thead>
  <tfoot>
    <tr>
      <th>id</th>
      <th>cosmid_id</th>
      <th>locus</th>
      <th>gene_type</th>
      <th>gene_class_description
      <th>functional_description</th>
    </tr>
  </tfoot>
</table>


<script>
  $(document).ready(function() {
    var table = $('#gene_table').DataTable({
      'ajax': '/static/wbm_gene_descs.json',
      'columns':[
        {'data':'id'},
        {'data':'cosmid_id'},
        {'data':'locus'},
        {'data':'gene_type'},
        {'data':'gene_class_description'},
        {'data':'functional_description'}
      ],
      'deferRender': true,
      'scrollY':'500px',
      'smart':true,
      'dom': 'Bfrtip',
      'buttons': [
          'copy', 'csv', 'excel', 'pdf', 'print'
      ]
    });


    table.on('draw', function() {
      var body = $(table.table().body());

      body.unhighlight();
      body.highlight(table.search());
    });

    $('#searchFile').on('click', function(){
      var file = document.getElementById("geneFile").files[0];
      var txt = "";
      if (file) {
          if (file.length == 0 || file.length > 1) {
              txt = "Please select a file.";
          } else {

            var reader = new FileReader();
            reader.onload = function(event) {
              var content = event.target.result;
              var lines = content.split('\n');

              table.search('the|and', true, false).draw();
              // for (var i = 0, f; f = lines[i]; i++){
              //   console.log(lines[i]);
              //   table.search(lines[i]).draw();
              // }
            }
            reader.readAsText(file);
          // console.log(reader);

            // console.log(data.type());
            // console.log(data.split(/\n/));

          }
      }
      else {
          if (file.value == "") {
              txt += "Please select a file.";
          } else {
              txt += "The file property is not supported by your browser!";
              txt  += "<br>The path of the selected file: " + file.value; // If the browser does not support the files property, it will return the path of the selected file instead.
          }
      }
      // document.getElementById("demo").innerHTML = txt;
    });

  });

</script>
{% endblock %}
